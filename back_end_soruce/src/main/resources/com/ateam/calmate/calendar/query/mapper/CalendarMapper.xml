<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ateam.calmate.calendar.query.mapper.CalendarMapper">

    <resultMap id="CalendarResultMap"
               type="com.ateam.calmate.calendar.query.dto.CalendarDTO">
        <id     column="id"              property="id"/>
        <result column="cal_day"         property="calDay"/>
        <result column="badge_count"     property="badgeCount"/>
        <result column="exercise_status" property="exerciseStatus"/>
        <result column="meal_status"     property="mealStatus"/>
        <result column="diary_status"    property="diaryStatus"/>
        <result column="member_id"       property="memberId"/>
    </resultMap>

    <!-- 기간 조회 -->
    <select id="selectCalendarRange" resultMap="CalendarResultMap">
        SELECT
        c.id,
        c.cal_day,
        c.badge_count,
        c.exercise_status,
        c.meal_status,
        c.diary_status,
        c.member_id
        FROM calender c
        <where>
            <if test="memberId != null">
                c.member_id = #{memberId}
            </if>
            <if test="startDate != null">
                <if test="memberId != null">
                    AND
                </if>
                c.cal_day &gt;= #{startDate}
            </if>
            <if test="endDate != null">
                <if test="memberId != null or startDate != null">
                    AND
                </if>
                c.cal_day &lt;= #{endDate}
            </if>
        </where>
        ORDER BY c.cal_day ASC
    </select>

    <!-- 일별 조회 -->
    <select id="selectCalendarByDay" resultMap="CalendarResultMap">
        SELECT
        c.id,
        c.cal_day,
        c.badge_count,
        c.exercise_status,
        c.meal_status,
        c.diary_status,
        c.member_id
        FROM calender c
        <where>
            DATE(c.cal_day) = #{day}
            <if test="memberId != null">
                AND c.member_id = #{memberId}
            </if>
        </where>
        ORDER BY c.cal_day ASC
    </select>

</mapper>
